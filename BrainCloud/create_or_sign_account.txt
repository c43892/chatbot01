"use strict";


function main() {
    var ret = {
        status: "failed"
    };
        
    var globalEntityProxy = bridge.getGlobalEntityServiceProxy();
    var searchResults = globalEntityProxy.getListByIndexedId(data.linkId, 1);
    if (searchResults.data.entityList.length > 0) {
        
        // account exists
        var acc = searchResults.data.entityList[0].data;
        ret.status = "succeed";
        ret.type = "existing";
        ret.account = JSON.stringify(acc);
    } else {
        
        // new account
        var acc = {};
        acc.linkId = data.linkId;
        acc.info = {
            credits: 0,
            displayingName: "",
            platform: data.platform
        };
        
        var postResult = globalEntityProxy.createEntityWithIndexedId("account", data.linkId, -1, {"other": 2}, acc);
        
        if (postResult.status == 200) {
            ret.status = "succeed";
            ret.type = "new";
            ret.account = JSON.stringify(acc);
        } else {
            ret.status = "failed";
        }
    }
    
    return ret;
}

main();
